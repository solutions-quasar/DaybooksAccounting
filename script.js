const CONFIG = {
    business: {
        name: "Daybooks Accounting",
        phone: "506-875-5108",
        email: "tracy@daybooks.ca",
        address: "Moncton, NB",
        url: "https://daybooks-accounting.netlify.app",
        facebook: "https://www.facebook.com/daybooks/",
        googleBusiness: "#", // Add real link if available
        areaServed: "Moncton & Surrounding Areas, Remote across Canada"
    },
    hero: {
        headline: "Gentle Accounting with Tracy",
        subhead: "Keep your books clean, your reporting clear, and your tax season stress-free. Professional bookkeeping for heart-centered small businesses.",
        primaryCTALabel: "Request a Consultation",
        primaryCTATarget: "#contact",
        image: "hero.png"
    },
    reviews: [
        {
            quote: "REPLACE WITH REAL REVIEW - Tracy has been instrumental in keeping my business books organized and stress-free.",
            name: "Small Business Owner",
            source: "Facebook",
            link: "https://www.facebook.com/daybooks/reviews"
        },
        {
            quote: "REPLACE WITH REAL REVIEW - Highly professional and explains everything in a way that actually makes sense.",
            name: "Freelancer",
            source: "Google",
            link: "https://www.facebook.com/daybooks/reviews"
        }
    ],
    whyChooseUs: [
        "Clear communication and quick answers",
        "Simple monthly process",
        "Support for small businesses",
        "Clean, organized books year-round",
        "Practical guidance (not jargon)"
    ],
    services: [
        {
            title: "Bookkeeping",
            description: "Full-cycle bookkeeping tailored to your business needs, ensuring accuracy and peace of mind.",
            icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5V5a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z"/><path d="M8 7h6"/><path d="M8 11h8"/><path d="M8 15h6"/></svg>`
        },
        {
            title: "Payroll Support",
            description: "Accurate payroll processing, including T4s and deductions, so your team is always paid on time.",
            icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>`
        },
        {
            title: "HST/GST Remittance",
            description: "Timely and accurate filing of your sales tax returns to avoid penalties and interest.",
            icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>`
        },
        {
            title: "Year-End Support",
            description: "Complete preparation for your year-end, making the transition to tax season seamless.",
            icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>`
        },
        {
            title: "Tax Preparation",
            description: "Personal and small business tax filing with E-file for fast processing.",
            icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>`
        },
        {
            title: "Cloud Accounting",
            description: "Help converting manual systems to user-friendly platforms like Sage, QuickBooks, or Xero.",
            icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19a5.5 5.5 0 0 0 2.5-10.5 8.5 8.5 0 1 0-15 5 4.5 4.5 0 1 0 1.5 8.5h11Z"/></svg>`
        }
    ],
    faq: [
        {
            question: "What industries do you specialize in?",
            answer: "I specialize in small business bookkeeping for trades and services, but I work with entrepreneurs across various sectors."
        },
        {
            question: "Do you work remotely?",
            answer: "Yes! I provide services both locally in the Moncton area and remotely to clients across Canada using cloud-based tools."
        },
        {
            question: "How much do your services cost?",
            answer: "Pricing is transparent and varies by service. For example, Individual E-File starts at $40, and Small Business E-File starts at $65. Bookkeeping is tailored to your volume."
        },
        {
            question: "Can you help me set up a new company?",
            answer: "Absolutely. I can help with new company Chart of Accounts set-up and guide you through the initial financial organization."
        },
        {
            question: "What accounting software do you use?",
            answer: "I am experienced with Sage 50, QuickBooks, and Xero, and I can help you transition to these platforms."
        },
        {
            question: "Why should I choose Daybooks over a big firm?",
            answer: "Big firms can be confusing and impersonal. I offer personalized service, clear explanations, and a focus on making your finances easy to understand."
        }
    ],
    howItWorks: [
        { step: 1, title: "Tell us what you need", desc: "Reach out via our form or call to discuss your business needs." },
        { step: 2, title: "We confirm scope", desc: "We'll define the specific support you need and the next steps." },
        { step: 3, title: "Ongoing support", desc: "Enjoy clean reporting and peace of mind while you focus on growth." }
    ],
    whoWeHelp: [
        "Small Business Owners",
        "Self-Employed",
        "Startups",
        "Trades & Services"
    ]
};

// Rendering Helpers
document.addEventListener('DOMContentLoaded', () => {
    renderContent();
    injectJSONLD();
    setupMobileNav();
    setupScrollAnimations();
    setupHeaderScroll();
    injectLogo();
});

function renderContent() {
    // Inject Year
    const yearEl = document.getElementById('year');
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    // Top Bar & Footer NAP
    const napElements = document.querySelectorAll('.nap-info');
    napElements.forEach(el => {
        el.innerHTML = `
            <a href="tel:${CONFIG.business.phone}">${CONFIG.business.phone}</a> | 
            <a href="mailto:${CONFIG.business.email}">${CONFIG.business.email}</a>
        `;
    });

    // Business Name
    const nameElements = document.querySelectorAll('.business-name');
    nameElements.forEach(el => el.textContent = CONFIG.business.name);

    const heroImageSide = document.querySelector('.hero-image-side');
    const heroTextSide = document.querySelector('.hero-text-side');
    if (heroTextSide && heroImageSide) {
        const h1 = heroTextSide.querySelector('h1');
        const p = heroTextSide.querySelector('p');
        const cta = heroTextSide.querySelector('.cta-button');

        if (h1) h1.textContent = CONFIG.hero.headline;
        if (p) p.textContent = CONFIG.hero.subhead;
        if (cta) {
            cta.textContent = CONFIG.hero.primaryCTALabel;
            cta.href = CONFIG.hero.primaryCTATarget;
        }
        heroImageSide.style.backgroundImage = `url('${CONFIG.hero.image}')`;
    }

    // Reviews Section
    const reviewsGrid = document.getElementById('reviews-grid');
    if (reviewsGrid) {
        reviewsGrid.innerHTML = CONFIG.reviews.map((review, index) => `
            <div class="review-card" data-animate style="transition-delay: ${index * 0.1}s">
                <p class="review-quote">"${review.quote}"</p>
                <p class="review-author">${review.name}</p>
                <div style="margin-top: 1rem; font-size: 0.7rem; opacity: 0.5;">${review.source} Verified</div>
            </div>
        `).join('');
    }

    // Why Choose Us
    const whyGrid = document.getElementById('why-grid');
    if (whyGrid) {
        whyGrid.innerHTML = CONFIG.whyChooseUs.map((item, index) => `
            <div class="why-item" data-animate style="transition-delay: ${index * 0.1}s">
                <span class="check-icon">âœ¦</span>
                <p>${item}</p>
            </div>
        `).join('');
    }

    // Services Snapshot
    const servicesGrid = document.getElementById('services-grid');
    if (servicesGrid) {
        const servicesToRender = window.location.pathname.includes('services.html') ? CONFIG.services : CONFIG.services.slice(0, 3);
        servicesGrid.innerHTML = servicesToRender.map((service, index) => `
            <div class="service-card" data-animate style="transition-delay: ${index * 0.1}s">
                <div class="service-icon-wrapper">
                    ${service.icon}
                </div>
                <h3>${service.title}</h3>
                <p>${service.description}</p>
                ${!window.location.pathname.includes('services.html') ? `
                    <a href="services.html" class="learn-more-link">
                        <span>Learn more</span>
                        <svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </a>
                ` : ''}
            </div>
        `).join('');
    }

    // FAQ Section
    const faqList = document.getElementById('faq-list');
    if (faqList) {
        const faqsToRender = window.location.pathname.includes('faq.html') ? CONFIG.faq : CONFIG.faq.slice(0, 5);
        faqList.innerHTML = faqsToRender.map(item => `
            <div class="faq-item" data-animate>
                <button class="faq-question">${item.question}</button>
                <div class="faq-answer"><p style="padding: 1rem 0 2rem;">${item.answer}</p></div>
            </div>
        `).join('');

        // FAQ Toggle Logic
        document.querySelectorAll('.faq-question').forEach(button => {
            button.addEventListener('click', () => {
                const answer = button.nextElementSibling;
                const isOpen = answer.style.maxHeight;

                document.querySelectorAll('.faq-answer').forEach(el => el.style.maxHeight = null);
                document.querySelectorAll('.faq-question').forEach(el => el.classList.remove('active'));

                if (!isOpen) {
                    answer.style.maxHeight = answer.scrollHeight + "px";
                    button.classList.add('active');
                }
            });
        });
    }

    // How It Works
    const howGrid = document.getElementById('how-grid');
    if (howGrid) {
        howGrid.innerHTML = CONFIG.howItWorks.map(item => `
            <div class="how-item" data-animate>
                <span class="step-number">0${item.step}</span>
                <h4 style="text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; font-size: 0.9rem; margin-bottom: 0.5rem;">${item.title}</h4>
                <p style="font-size: 0.95rem; opacity: 0.7;">${item.desc}</p>
            </div>
        `).join('');
    }

    // Who We Help
    const helpGrid = document.getElementById('help-grid');
    if (helpGrid) {
        helpGrid.innerHTML = CONFIG.whoWeHelp.map(item => `
            <div class="help-item">${item}</div>
        `).join('');
    }
}

function injectJSONLD() {
    const schema = {
        "@context": "https://schema.org",
        "@type": ["AccountingService", "LocalBusiness"],
        "name": CONFIG.business.name,
        "image": CONFIG.business.url + "/" + CONFIG.hero.image,
        "url": CONFIG.business.url,
        "telephone": CONFIG.business.phone,
        "email": CONFIG.business.email,
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Moncton",
            "addressRegion": "NB",
            "addressCountry": "CA"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": 46.0878,
            "longitude": -64.7782
        },
        "areaServed": CONFIG.business.areaServed,
        "sameAs": [
            CONFIG.business.facebook
        ]
    };
    const script = document.createElement('script');
    script.type = "application/ld+json";
    script.text = JSON.stringify(schema);
    document.head.appendChild(script);
}

function setupMobileNav() {
    const menuBtn = document.querySelector('.menu-toggle');
    const nav = document.querySelector('nav ul');
    if (menuBtn && nav) {
        menuBtn.addEventListener('click', () => {
            nav.classList.toggle('active');
            menuBtn.classList.toggle('active');
            document.body.classList.toggle('menu-open');
        });

        // Close menu when clicking a link
        nav.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                nav.classList.remove('active');
                menuBtn.classList.remove('active');
                document.body.classList.remove('menu-open');
            });
        });
    }
}

function setupScrollAnimations() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                // Optional: stop observing once visible
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

    // Only observe elements that ALREADY have the attribute in HTML
    const animateElements = document.querySelectorAll('[data-animate]');
    if (animateElements.length > 0) {
        animateElements.forEach(el => observer.observe(el));
    } else {
        // Fallback: if no animate elements found (e.g. dynamic injection failed), check again after a short delay
        setTimeout(() => {
            document.querySelectorAll('[data-animate]').forEach(el => observer.observe(el));
        }, 500);
    }

    // Safety fallback: if anything is still hidden after 3 seconds, show everything
    setTimeout(() => {
        document.querySelectorAll('[data-animate]:not(.visible)').forEach(el => {
            el.classList.add('visible');
        });
    }, 3000);
}

function setupHeaderScroll() {
    const header = document.querySelector('header');
    if (header) {
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
    }
}

function injectLogo() {
    const logos = document.querySelectorAll('.logo-container');
    const logoHTML = `
        <div class="logo-wrap">
            <img src="logo.png" alt="Daybooks Accounting Logo" class="logo-img">
            <div class="logo-text">
                <span class="logo">Daybooks</span>
                <span class="tagline">Accounting</span>
            </div>
        </div>
    `;
    logos.forEach(el => {
        el.innerHTML = logoHTML;
    });
}
